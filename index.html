<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Scripter</title>
  <style type="text/css" media="screen">
    body {
        overflow: hidden;
    }
    
    #editor { 
        margin: 0;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 810px;
        right: 0;
    }
  </style>
		
</head>
	<body bgcolor="black" style="position: absolute; left: 45px;">
		<center>
			<div id="jsapp" style="left:10px">
				<font color="#FFFFFF", style="position: absolute; font-size: 10px; font-family: Courier New">
					<span id="framecounter">(0/0)</span>
				</font>
				<script type="text/javascript" src="lib/melonJS-0.9.6-min.js"></script>
				<script type="text/javascript" src="entities.js"></script>
				<script type="text/javascript" src="main.js"></script>
			</div>
		</center>
<pre id="editor" style="width:400px;height:560px">
</pre>
<input type="button" value="Run" onClick="script()" style="position: absolute;right:10px;top: 10px"/>

<script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
     var VAR = {
    myvalue: 0,
    
    doublejump: 0,
    block: false
            };
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monkai");
    editor.getSession().setMode("ace/mode/javascript");
     function script(){
     //alert(editor.session.getValue());
    eval(editor.getSession().getValue());
    }
/* polluted source code :vg*/

/* walkqueue, concurrent for multiple consecutive calls */
var walkqueue = [];
function walk(){       /* THIS NOW WORKS */
  player = me.game.getEntityByName("mainPlayer")[0];
  /* Amazing code follows. *
   * Queue implemented, move by 60px for each call. *
   * Not clearing queues. This was fun. *
   */
   console.log("walknow");
   
   
  walkqueue.push(function(){
                    player.doWalk(false);
                    setInterval(function() {
                        if(player.pos.x - currentPosX > 60){
                            player.vel.x = 0;
                        }
                    }, 20);
                 });

  if(walkqueue.length > 0){
    executeQueue = setInterval(function(){
                                   if(walkqueue.length > 0 && player.vel.x == 0){
                                       currentPosX = player.pos.x; 
                                       (walkqueue.shift())();
                                   }
                               }, 20);
  }
  else{
  console.log("clear");
    window.clearInterval(executeQueue);
    currentPosX = player.pos.x;
  }
  
  
  /*
  
  VAR.myvalue=10;   // NOT HOW THINGS ARE DONE. :vg
  VAR.block = true;
  setTimeout(function () {
      VAR.myvalue=0;
      VAR.block = false;
    }, n*1000);
    */
}
function jump(direction){ /* 'l' or 'r' or 'u' */
    VAR.c = direction;
    console.log("you want me to jump");
}
/* Yes, I know and I'm sorry. :vg*//* not needed anymore */
function doublejump(){
    jump();
    doublejump = 1;
    
}
 
</script>

	</body>
</html>
